{% extends 'template/layout.twig' %}


{% block title %}
    <title>Praticien| {{unique_patient.first_name}} {{unique_patient.last_name}}</title>
{% endblock %}
{% block topbar %}
    <p>LALALALALA</p>
{% endblock %}
{% block content %}
    <!-- Load the `mapbox-gl-geocoder` plugin. -->
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">
    <div class="col-md-12">
        <div class="row">
            <div class="col-md-6">
                <div id='map' style='width: 100%; height: 500px;'></div>
            </div>
            <div class="col-md-6">
                <div class="card shadow col-12">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary"><i class="fa fa-stethoscope"></i> Praticiens</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered display" id="" width="100%" cellspacing="0">
                                <thead>
                                <tr>
                                    <th scope="col">ID</th>
                                    <th scope="col">Titre</th>
                                    <th scope="col">Spécialité</th>
                                    <th scope="col">Nom & Prénom</th>
                                    <th scope="col">Ville</th>
                                    <th scope="col"></th>
                                </tr>
                                </thead>
                                <tbody>
                                {%for practitian in practitians %}
                                    <tr>
                                        <th scope="row">{{practitian.users_id}}</th>

                                        <th scope="row">

                                            {% if practitian.type == 1 %}
                                                Docteur
                                            {%elseif practitian.type == 2 %}
                                                Chirurgien
                                            {% elseif practitian.type == 3 %}
                                                Infirmier
                                            {%elseif practitian.type == 4 %}
                                                Aide Soignant
                                            {% elseif practitian.type == 5 %}
                                                Psychologue
                                            {% endif %}

                                        </th>
                                        <td>

                                            {% if practitian.speciality == 1 %}
                                                Généraliste
                                            {% elseif practitian.speciality == 2 %}
                                                Bariatrique
                                            {% elseif practitian.speciality == 3 %}
                                                Psychologie
                                            {% endif %}

                                        </td>
                                        <td><button onclick="practitian({{practitian.users_id}})">{{practitian.last_name}} {{practitian.first_name}}</button></td>
                                        <td>{{practitian.address_city|convert_encoding('UTF-8', 'ISO-8859-1')}}</td>
                                        <td>
                                            <input type="checkbox">
                                        </td>
                                    </tr>
                                {%endfor%}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <br>
        <div class="col-md-6">
            <div class="card shadow col-12">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary"><i class="fa fa-stethoscope"></i> Praticiens</h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <p id="avatar_ajax"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1Ijoic2VibG9lYiIsImEiOiJjbDJ3MWE0OWUwaGUxM2ZxbWI1ZTlucjdtIn0.q-sLFfayOzT5jV8PQLGvvw';
        const map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/sebloeb/cl2w0rz9c000e15pff4bz9ft9', // style URL
            center: [{{city_patient.longitude}}, {{city_patient.latitude}}], // starting position [lng, lat]
            zoom: 11 // starting zoom
        });

        map.addControl(
            new MapboxGeocoder({
                accessToken: mapboxgl.accessToken,
                mapboxgl: mapboxgl
            })
        );

        // Create a default Marker and add it to the map.
        const marker1 = new mapboxgl.Marker({color: '#BE7781'})
            .setLngLat([{{city_patient.longitude}}, {{city_patient.latitude}}])
            .addTo(map);

        {% for practitian in city_practitian %}
        // Create a default Marker and add it to the map.
        const marker{{practitian.users_id}} = new mapboxgl.Marker({color: '#668AB2'})
            .setLngLat([{{practitian.longitude}}, {{practitian.latitude}}])
            .setPopup(new mapboxgl.Popup().setHTML("<div class='row'><div class='col-md-3'><img src='image/{{practitian.avatar}}' width='150%'></div><div class='col-md-9'><p><strong>{{practitian.last_name}} {{practitian.first_name}}</strong></p><p style='text-align: center;'>{% if practitian.type == 1 %} Docteur {%elseif practitian.type == 2 %} Chirurgien {% elseif practitian.type == 3 %} Infirmier {%elseif practitian.type == 4 %} Aide Soignant {% elseif practitian.type == 5 %} Psychologue {% endif %} - {% if practitian.speciality == 1 %} Généraliste {% elseif practitian.speciality == 2 %} Bariatrique {% elseif practitian.speciality == 3 %} Psychologie {% endif %}</p><h5 style='text-align: center;'>ID: <strong>{{practitian.users_id}}</strong></h3></div></div>")) // add popup
            .addTo(map);
       // marker{{practitian.users_id}}.togglePopup(); // toggle popup open or closed

        {% endfor %}
    </script>

    <script>
        function practitian (id){
            $.ajax({
                url: "admin/practitian.php?id="+id,
                DataType: "application/json"
            }).done(function(data) {
                var lala = id
                console.log(data);
                var result = JSON.parse(data)

                console.log(result['mail'])

                if (result.type === 1){
                    document.getElementById('type_ajax').innerHTML = "Docteur";
                }else if (result.type === 2){
                    document.getElementById('type_ajax').innerHTML = "Chirurgien";
                }else if (result.type === 3){
                    document.getElementById('type_ajax').innerHTML = "Infirmier";
                }else if (result.type === 4){
                    document.getElementById('type_ajax').innerHTML = "Aide Soignant";
                }else if (result.type === 5){
                    document.getElementById('type_ajax').innerHTML = "Psychologue";
                }

                if (result.speciality === 1){
                    document.getElementById('speciality_ajax').innerHTML = "Généraliste";
                }else if (result.speciality === 2){
                    document.getElementById('speciality_ajax').innerHTML = "Bariatrique";
                }else if (result.speciality === 3){
                    document.getElementById('speciality_ajax').innerHTML = "Psychologie";
                }

                document.getElementById('avatar_ajax').innerHTML = String::result.avatar;
                document.getElementById('name_ajax').innerHTML = result.last_name + " " + result.first_name;
                document.getElementById('description_ajax').innerHTML = result.description;
                document.getElementById('phone_ajax').innerHTML = result.phone;
                document.getElementById('mail_ajax').innerHTML = result.mail;
                document.getElementById('address_street_ajax').innerHTML = result.address_street;
                document.getElementById('address_cp_ajax').innerHTML = result.address_cp;
                document.getElementById('address_city_ajax').innerHTML = result.address_city;

            });
        }
    </script>
{% endblock %}